<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2563eb">
  <link rel="icon" type="image/png" href="favicon.png" sizes="32x32">
  <title>Video Hub</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link id="css" rel="stylesheet" href="style.css">
</head>
<body>

  <div id="loadingScreen" class="loading-screen">
    <i class="fa-solid fa-spinner fa-spin"></i>
    <p>Wait a minute</p>
  </div>

  <header class="header">
    <h1>ðŸŽ¬ Video Hub</h1>
    <p>Simple video showcase platform</p>
  </header>

  <section class="search-section">
    <div class="search-wrapper">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input
        type="text"
        id="searchInput"
        placeholder="Search videos..."
        autocomplete="off"
      />
    </div>

    <p id="noResult" class="no-result">
      The video you are looking for is not available.
    </p>
  </section>

  <main class="container">
    <div class="video-list" id="videoList"></div>
  </main>

  <footer class="footer">
    <p>
      Want your video here?
      <a href="mailto:admin@wiw.my.id">admin@wiw.my.id</a>
    </p>
    <small>
      Note: This is a YouTube parody. We do not use YouTube trademarks.
    </small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/canvas-snowfall@1.0.0/dist/snowfall.min.js"></script>
  <script id="js" src="script.js"></script>

  <script>
    let currentVersion = null;

    async function getVersion() {
      try {
        const res = await fetch("/version.json", { cache: "no-store" });
        const data = await res.json();
        return data.version;
      } catch {
        return null;
      }
    }

    function applyVersion(v) {
      if (!v) return;
      document.getElementById("css").href = `/style.css?v=${v}`;
      document.getElementById("js").src = `/script.js?v=${v}`;
    }

    getVersion().then(v => {
      currentVersion = v;
      applyVersion(v);
    });

    setInterval(async () => {
      const latest = await getVersion();
      if (latest && latest !== currentVersion) location.reload();
    }, 30000);

    // JAGA JAGA KALO STUCK
    function hideLoading() {
      const l = document.getElementById("loadingScreen");
      l.style.opacity = "0";
      l.style.pointerEvents = "none";
    }

    window.addEventListener("load", () => {
      // start snow AFTER page load
      snowfall.start({
        maxFlakes: 80,
        speed: 1
      });

      setTimeout(hideLoading, 500);
    });

    // fallback kalau load event gagal
    setTimeout(hideLoading, 3000);
  </script>

</body>
</html>
